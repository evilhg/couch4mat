
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>COUCH4MAT: CouchDB Matlab tbox</title><meta name="generator" content="MATLAB 9.0"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2016-11-21"><meta name="DC.source" content="couch_pub.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>COUCH4MAT: CouchDB Matlab tbox</h1><!--introduction--><p>Jonas Almeida, April 2010</p><p>Updated by Gustavo Delfino on Nov 2016</p><p>This manual was generated automatically by running pub.m .</p><p>The couch tbox revolves around a data structure and a single command. The data structure can be created by just pointing the command to a a URL where CouchDB is installed. If no URL is provided then the command assumes you are targetting a local deployment, and will use localhost:5984.</p><p>All CouchDB functionalities are coded under the couch command with one exception - the JSON parsers. These two parsers, json2mat and mat2json, collectively designated as json4mat.</p><p>Old versions of couch4mat and json4mat may still be available at <a href="http://couch4mat.googlecode.com">http://couch4mat.googlecode.com</a> and <a href="http://json4mat.googlecode.com">http://json4mat.googlecode.com</a> The versions on https://github.com/mathbiol/couch4mat are newer.</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Installation</a></li><li><a href="#2">couch()</a></li><li><a href="#4">Create database</a></li><li><a href="#5">List all databases</a></li><li><a href="#6">Insert a document</a></li><li><a href="#12">List all docs</a></li><li><a href="#14">Get one doc</a></li><li><a href="#17">Doc output argument</a></li><li><a href="#18">JSON4MAT</a></li><li><a href="#19">Delete one document</a></li><li><a href="#20">Delete database</a></li><li><a href="#21">Authentication</a></li><li><a href="#22">FreeMat</a></li><li><a href="#23">Create Admin user</a></li><li><a href="#25">Session</a></li><li><a href="#26">Admins</a></li><li><a href="#27">Delete Admin</a></li></ul></div><h2>Installation<a name="1"></a></h2><p>You can download CouchDB for the different OSs from <a href="http://couchdb.apache.org/">http://couchdb.apache.org/</a></p><p>In addition to Matlab this tutorial also assumes you have CURL installed. If you are running on Windows you can get it from <a href="http://curl.haxx.se/">http://curl.haxx.se/</a>. If you are running this on a Mac or Linux you probably already have it.</p><h2>couch()<a name="2"></a></h2><p>Lets start by calling the local deployment, you can also target and arbitrary deployment by using the URL as the input argument, i.e. couch('url goes here')</p><pre class="codeinput">c=couch
</pre><pre class="codeoutput">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current 
                                 Dload  Upload   Total   Spent    Left  Speed 
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0100   151  100   151    0     0   9437      0 --:--:-- --:--:-- --:--:--  9437{"couchdb":"Welcome","uuid":"96739cb96002ee7eb1ef6500c0b61b36","version":"1.6.1","vendor":{"version":"1.6.1","name":"The Apache Software Foundation"}}
 

c = 

     url: 'http://localhost:5984'
     opt: 'welcome'
    curl: [1x1 struct]
    info: [1x1 struct]

</pre><p>this structure, c, will now be used as the input argument of couch() to which we will add more arguments.</p><h2>Create database<a name="4"></a></h2><p>The name of the database you want to create can be passed directly in the c structure at c.db.name or can be sent as a third input argument, which we'll do here:</p><pre class="codeinput">c=couch(c,<span class="string">'create db'</span>,<span class="string">'mydb'</span>)
</pre><pre class="codeoutput">
c = 

     url: 'http://localhost:5984'
     opt: 'create db'
    curl: [1x1 struct]
    info: [1x1 struct]
      db: [1x1 struct]

</pre><h2>List all databases<a name="5"></a></h2><p>As with other usages of couch we'll use arguments that are as close as possible to CouchDB's own syntax. For example, to get a list of all databases one would call [c.url,'/_all_dbs'] so the second argument, and field in the updated c structure, is 'all_dbs':</p><pre class="codeinput">c=couch(c,<span class="string">'all_dbs'</span>)
</pre><pre class="codeoutput">
c = 

        url: 'http://localhost:5984'
        opt: 'all_dbs'
       curl: [1x1 struct]
       info: [1x1 struct]
         db: [1x1 struct]
    all_dbs: {1x12 cell}

</pre><h2>Insert a document<a name="6"></a></h2><p>the document can be provided already as a JSON string</p><pre class="codeinput">[c,doc]=couch(c,<span class="string">'insert doc'</span>,<span class="string">'{"hello":"world"}'</span>);
</pre><p>or as a structured variable, which can include additional fields</p><pre class="codeinput">lala.hello=<span class="string">'world'</span>;
lala.randM=randi([0 99],5,5)
[c,doc]=couch(c,<span class="string">'insert doc'</span>,lala)
</pre><pre class="codeoutput">
lala = 

    hello: 'world'
    randM: [5x5 double]


c = 

        url: 'http://localhost:5984'
        opt: 'insert doc'
       curl: [1x1 struct]
       info: [1x1 struct]
         db: [1x1 struct]
    all_dbs: {1x12 cell}
        doc: [1x1 struct]


doc = 

     ok: 'true'
     id: '1bac260bb68846a01d573c2d4f03acba'
    rev: '1-500c4569b40f086cfe4e2ea9ecf73cfa'

</pre><p>note that the response in c.curl has all the details of the exchange,</p><pre class="codeinput">c.curl
</pre><pre class="codeoutput">
ans = 

       msg: '{"ok":true,"id":"1bac260bb68846a01d573c2d4f03acba","rev":"1-5...'
    system: 2
       ans: 0
      call: 'curl -kX POST http://localhost:5984/mydb -H "Content-Type: ap...'
      json: [1x1 struct]
      more: [1x1 struct]

</pre><p>including the _id and _rev of the document</p><pre class="codeinput">c.curl.json
</pre><pre class="codeoutput">
ans = 

     ok: 'true'
     id: '1bac260bb68846a01d573c2d4f03acba'
    rev: '1-500c4569b40f086cfe4e2ea9ecf73cfa'

</pre><p>which is evertheless returned as a second output argument, doc. If only one output argument is specified that will be doc</p><pre class="codeinput">doc=couch(c,<span class="string">'insert doc'</span>,lala);
</pre><p>see "Doc output argument" section for more on this</p><h2>List all docs<a name="12"></a></h2><p>as with 'all_dbs' but now for documents of a database</p><pre class="codeinput">c=couch(c,<span class="string">'all_docs'</span>);
c.db.all_docs
</pre><pre class="codeoutput">
ans = 

    total_rows: 3
        offset: 0
          rows: [1x3 struct]

</pre><p>and each row will contain the key/value returned by that minimalist view</p><pre class="codeinput">c.db.all_docs.rows(:)
</pre><pre class="codeoutput">
ans = 

3x1 struct array with fields:

    id
    key
    value

</pre><h2>Get one doc<a name="14"></a></h2><p>Lets get the last document inserted using its _id</p><pre class="codeinput">id = c.db.all_docs.rows(end).id
</pre><pre class="codeoutput">
id =

1bac260bb68846a01d573c2d4f03af27

</pre><p>and now retrieve the entry</p><pre class="codeinput">[c,doc]=couch(c,<span class="string">'doc'</span>,id)
</pre><pre class="codeoutput">
c = 

        url: 'http://localhost:5984'
        opt: 'doc'
       curl: [1x1 struct]
       info: [1x1 struct]
         db: [1x1 struct]
    all_dbs: {1x12 cell}
        doc: [1x1 struct]


doc = 

       id: '1bac260bb68846a01d573c2d4f03af27'
      rev: '1-500c4569b40f086cfe4e2ea9ecf73cfa'
    hello: 'world'
    randM: [5x5 double]

</pre><p>doc comes out as the second output argument of couch(). If you only provide one output argument couch will assume it is doc such that you can conveniently do doc=couch(c,'doc',id).</p><h2>Doc output argument<a name="17"></a></h2><p>In the previous example two output arguments were used, the c structure and usual and the target answer to the URL call, the document. So now is a good time to look at the use of output arguments. Because c is used as couch db document model it is expected as input and output argument of couch(). However, it may be convenient in functions such as the previous one to simply return the document that was requested. To acomodate that in functions such as these the number of output arguments is used to decide what is returned. If there is only one output argument doc is returned. This pattern will be used for all doc centric commands, such as 'delete doc' further ahead in this tutorial.</p><pre class="codeinput">doc=couch(c,<span class="string">'doc'</span>,id)
</pre><pre class="codeoutput">
doc = 

       id: '1bac260bb68846a01d573c2d4f03af27'
      rev: '1-500c4569b40f086cfe4e2ea9ecf73cfa'
    hello: 'world'
    randM: [5x5 double]

</pre><h2>JSON4MAT<a name="18"></a></h2><p>This is also a good time to recognize what the JSON4MAT parsers are doing to accomodate Matlab data own formats. Notice that doc.randM is a 2D matrix but JSON has no convention to represent dimensionality even if it is reasonable to imagine it as an array of arrays (see below). JSON4MAT is doing that and more - following Matlab's loose management of datatypes it is also attempting to create numeric matrices from JSON arrays and only when that fails will it follow a the conservative route of generating an array of cells. For more information see <a href="http://json4mat.googlecode.com">http://json4mat.googlecode.com</a></p><pre class="codeinput">json=urlread([c.url,<span class="string">'/'</span>,c.db.name,<span class="string">'/'</span>,id])
doc=json2mat(json)
randM=doc.randM
</pre><pre class="codeoutput">
json =

{"_id":"1bac260bb68846a01d573c2d4f03af27","_rev":"1-500c4569b40f086cfe4e2ea9ecf73cfa","hello":"world","randM":[[54,47,64,78,55],[98,56,30,78,30],[71,26,13,66,93],[83,74,47,13,98],[43,50,36,2,28]]}



doc = 

       id: '1bac260bb68846a01d573c2d4f03af27'
      rev: '1-500c4569b40f086cfe4e2ea9ecf73cfa'
    hello: 'world'
    randM: [5x5 double]


randM =

    54    47    64    78    55
    98    56    30    78    30
    71    26    13    66    93
    83    74    47    13    98
    43    50    36     2    28

</pre><h2>Delete one document<a name="19"></a></h2><p>CouchDB will want to make sure you want to delete and entry by asking for both the document id and revision id. CouchDB will retrieve the rev id for you so if you don't want to make sure you are deleting a version you know then couch4mat makes it dangerously easy by letting you do it by asking only for the document id. As for 'get doc' if there is only one output argument then the deleted document will be returned so you can use doc=couch(c,'delete doc',id). If you use two output arguments note that c.db.all_docs will be updated.</p><pre class="codeinput">[c,doc]=couch(c,<span class="string">'delete doc'</span>,id);
c.db.all_docs
</pre><pre class="codeoutput">
ans = 

    total_rows: 3
        offset: 0
          rows: [1x3 struct]

</pre><h2>Delete database<a name="20"></a></h2><p>After the previous examples this one will be self-explanatory. Remember that the database name is the one specified at c.db.name. The reason not to allow database deleting with the same immediate syntax as deleting a document (with the database as the third input argument) is to make it a little harder to do in order to prevent unwanted deletion of a lot of data.</p><pre class="codeinput">c=couch(c,<span class="string">'delete db'</span>)
</pre><pre class="codeoutput">
c = 

        url: 'http://localhost:5984'
        opt: 'delete db'
       curl: [1x1 struct]
       info: [1x1 struct]
         db: [1x1 struct]
    all_dbs: {1x12 cell}
        doc: [1x1 struct]

</pre><h2>Authentication<a name="21"></a></h2><p>All previous examples assume an open couch deployment which is not likely to be the case when you are hosting data or applications for others. The syntax for providing autentication information is as follows:</p><pre>c=couch('url','auth', ...
        '{username:usernamehere,password:passwordhere}')</pre><p>The use of "auth" is similar to that of "welcome" and returns the same statistics. This command was also tested with hosted couch deployment at cloudant.com which is configured to support use of SSL. For example:</p><pre>c=couch('https://youraccount.cloudant.com','auth', ...
        '{username:usernamehere, password:passwordhere}');</pre><p>Note the third input argument can either be a structure or a JSON string. The latter was used in the example above which is converted automatically into a structure. You may have noted the JSON syntax employed here is not entirely legal ("" are missing bouding the username and password strings). This loose typing is supported alongside regular JSON typing by json2mat as described in the JSON4MAT manual at <a href="http://json4mat.googlecode.com/hg/html/json4mat_pub.html#6">http://json4mat.googlecode.com/hg/html/json4mat_pub.html#6</a> .</p><h2>FreeMat<a name="22"></a></h2><p>FreeMat is a free open source clone of Matlab which is mostly compatible with regular m-code. "most" is not "all" so a few additional functions were written to deal with the differences, such as json2freemat and cell2freemat (equivalent to json2mat and cell2mat in regular Matlab). The good news is that couch() was written to detect which m-interpreter you are using and use the right functions so you don't have to worry about this: couch() will run equally well in Matlab and FreeMat :-).</p><h2>Create Admin user<a name="23"></a></h2><p>Creating and admin user will finish the "admin party" and will create the _users database. Note the output argument is not c, i.e. no authentication information is included in c yet.</p><pre class="codeinput">c=couch; <span class="comment">% start from scratch</span>
a=couch(c,<span class="string">'insert admin'</span>,<span class="string">'{username:lala,password:lele}'</span>);
</pre><pre class="codeoutput">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current 
                                 Dload  Upload   Total   Spent    Left  Speed 
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0100   151  100   151    0     0    151      0  0:00:01 --:--:--  0:00:01  147k{"couchdb":"Welcome","uuid":"96739cb96002ee7eb1ef6500c0b61b36","version":"1.6.1","vendor":{"version":"1.6.1","name":"The Apache Software Foundation"}}
 
</pre><p>First add authenticaion information and then check one's own entry in _users database.</p><pre class="codeinput">c.auth.username=<span class="string">'lala'</span>;
c.auth.password=<span class="string">'lele'</span>;
c=couch(c,<span class="string">'db'</span>,<span class="string">'_users'</span>);
c.db.info
</pre><pre class="codeoutput">
ans = 

                 db_name: '_users'
               doc_count: 1
           doc_del_count: 0
              update_seq: 1
               purge_seq: 0
         compact_running: 'false'
               disk_size: 4194
               data_size: 2141
     instance_start_time: '1478526734612000'
     disk_format_version: 6
    committed_update_seq: 1

</pre><h2>Session<a name="25"></a></h2><p>The session will now contain information about the authenticated user:</p><pre class="codeinput">s=couch(c,<span class="string">'session'</span>)
s.info
</pre><pre class="codeoutput">
s = 

         ok: 'true'
    userCtx: [1x1 struct]
       info: [1x1 struct]


ans = 

          authentication_db: '_users'
    authentication_handlers: {'oauth'  'cookie'  'default'}
              authenticated: 'default'

</pre><h2>Admins<a name="26"></a></h2><p>for some reason I don't understand one can't get the admin user information back from the _users database. Instead one has to go to the _config/admins database</p><pre class="codeinput">c=couch(c,<span class="string">'db'</span>,<span class="string">'_config/admins'</span>);
c.db.info
</pre><pre class="codeoutput">
ans = 

    lala: '-pbkdf2-65034c0f4de8c89c15f7c8476834494101da4f36,92c7b6c29ece65...'

</pre><h2>Delete Admin<a name="27"></a></h2><p>Any admin can delete any admin. Since we have created only one admin, by deleting it we are left without admins and the admin party in the localhost resumes. Note removing admin is a regular DELETE with no worries about versioning.</p><pre class="codeinput">a=couch(c,<span class="string">'delete admin'</span>,<span class="string">'lala'</span>)
a.curl.call
</pre><pre class="codeoutput">
a = 

     url: 'http://localhost:5984'
     opt: 'delete admin'
    curl: [1x1 struct]
    info: [1x1 struct]
    auth: [1x1 struct]
      db: [1x1 struct]


ans =

curl -kX DELETE http://lala:lele@localhost:5984/_config/admins/lala

</pre><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2016a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% COUCH4MAT: CouchDB Matlab tbox
%
% Jonas Almeida, April 2010
%
% Updated by Gustavo Delfino on Nov 2016
%
% This manual was generated automatically by running pub.m .
%
% The couch tbox revolves around a data structure and a single command.
% The data structure can be created by just pointing the command to a a URL
% where CouchDB is installed. If no URL is provided then the command
% assumes you are targetting a local deployment, and will use
% localhost:5984.
%
% All CouchDB functionalities are coded under the couch command with one
% exception - the JSON parsers. These two parsers, json2mat and mat2json,
% collectively designated as json4mat.
%
% Old versions of couch4mat and json4mat may still be available at
% http://couch4mat.googlecode.com and http://json4mat.googlecode.com
% The versions on https://github.com/mathbiol/couch4mat are newer.
%

%% Installation
%
% You can download CouchDB for the different OSs from
% http://couchdb.apache.org/
%
% In addition to Matlab this tutorial also assumes you have CURL installed.
% If you are running on Windows you can get it from http://curl.haxx.se/.
% If you are running this on a Mac or Linux you probably already have it.
%
%% couch()
% Lets start by calling the local deployment, you can also target and
% arbitrary deployment by using the URL as the input argument, i.e.
% couch('url goes here')
c=couch
%%
% this structure, c, will now be used as the input argument of couch() to
% which we will add more arguments.
%
%% Create database
% The name of the database you want to create can be passed directly in the
% c structure at c.db.name or can be sent as a third input argument, which
% we'll do here:
c=couch(c,'create db','mydb')
%% List all databases
% As with other usages of couch we'll use arguments that are as close as
% possible to CouchDB's own syntax. For example, to get a list of all
% databases one would call [c.url,'/_all_dbs'] so the second argument, and
% field in the updated c structure, is 'all_dbs':
c=couch(c,'all_dbs')
%% Insert a document
% the document can be provided already as a JSON string
[c,doc]=couch(c,'insert doc','{"hello":"world"}');
%%
% or as a structured variable, which can include additional fields
lala.hello='world';
lala.randM=randi([0 99],5,5)
[c,doc]=couch(c,'insert doc',lala)
%%
% note that the response in c.curl has all the details of the exchange,
c.curl
%%
% including the _id and _rev of the document
c.curl.json
%%
% which is evertheless returned as a second output argument, doc. If only
% one output argument is specified that will be doc
doc=couch(c,'insert doc',lala);
%%
% see "Doc output argument" section for more on this
%% List all docs
% as with 'all_dbs' but now for documents of a database
c=couch(c,'all_docs');
c.db.all_docs
%%
% and each row will contain the key/value returned by that minimalist view
c.db.all_docs.rows(:)
%% Get one doc
% Lets get the last document inserted using its _id
id = c.db.all_docs.rows(end).id
%%
% and now retrieve the entry
[c,doc]=couch(c,'doc',id)
%%
% doc comes out as the second output argument of couch(). If you only
% provide one output argument couch will assume it is doc such that you can
% conveniently do doc=couch(c,'doc',id).
%% Doc output argument
% In the previous example two output arguments were used, the c structure
% and usual and the target answer to the URL call, the document. So now is
% a good time to look at the use of output arguments. Because c is used as
% couch db document model it is expected as input and output argument of
% couch(). However, it may be convenient in functions such as the
% previous one to simply return the document that was requested. To
% acomodate that in functions such as these the number of output arguments
% is used to decide what is returned. If there is only one output argument
% doc is returned. This pattern will be used for all doc centric commands,
% such as 'delete doc' further ahead in this tutorial.
doc=couch(c,'doc',id)
%% JSON4MAT
% This is also a good time to recognize what the JSON4MAT parsers are doing
% to accomodate Matlab data own formats. Notice that doc.randM is a 2D
% matrix but JSON has no convention to represent dimensionality even if it
% is reasonable to imagine it as an array of arrays (see below). JSON4MAT
% is doing that and more - following Matlab's loose management of datatypes
% it is also attempting to create numeric matrices from JSON arrays and
% only when that fails will it follow a the conservative route of
% generating an array of cells. For more information see
% http://json4mat.googlecode.com
json=urlread([c.url,'/',c.db.name,'/',id])
doc=json2mat(json)
randM=doc.randM
%% Delete one document
% CouchDB will want to make sure you want to delete and entry by asking for
% both the document id and revision id. CouchDB will retrieve the rev id
% for you so if you don't want to make sure you are deleting a version you
% know then couch4mat makes it dangerously easy by letting you do it by 
% asking only for the document id. As for 'get doc' if there is only one 
% output argument then the deleted document will be returned so you can use
% doc=couch(c,'delete doc',id). If you use two output arguments note that 
% c.db.all_docs will be updated.
[c,doc]=couch(c,'delete doc',id);
c.db.all_docs
%% Delete database
% After the previous examples this one will be self-explanatory. Remember
% that the database name is the one specified at c.db.name. The reason not
% to allow database deleting with the same immediate syntax as deleting a
% document (with the database as the third input argument) is to make it a
% little harder to do in order to prevent unwanted deletion of a lot of
% data.
c=couch(c,'delete db')
%% Authentication
% All previous examples assume an open couch deployment which is not likely
% to be the case when you are hosting data or applications for others. The 
% syntax for providing autentication information is as follows:
%
%  c=couch('url','auth', ...
%          '{username:usernamehere,password:passwordhere}')
%
% The use of "auth" is similar to that of "welcome" and returns the same
% statistics. This command was also tested with hosted couch deployment at
% cloudant.com which is configured to support use of SSL. For example:
%
%  c=couch('https://youraccount.cloudant.com','auth', ...
%          '{username:usernamehere, password:passwordhere}');
%
% Note the third input argument can either be a structure or a JSON string.
% The latter was used in the example above which is converted automatically
% into a structure. You may have noted the JSON syntax employed here is not
% entirely legal ("" are missing bouding the username and password
% strings). This loose typing is supported alongside regular JSON typing by
% json2mat as described in the JSON4MAT manual at 
% http://json4mat.googlecode.com/hg/html/json4mat_pub.html#6 .
%% FreeMat
% FreeMat is a free open source clone of Matlab which is mostly compatible
% with regular m-code. "most" is not "all" so a few additional functions
% were written to deal with the differences, such as json2freemat and
% cell2freemat (equivalent to json2mat and cell2mat in regular Matlab). The
% good news is that couch() was written to detect which m-interpreter you
% are using and use the right functions so you don't have to worry about
% this: couch() will run equally well in Matlab and FreeMat :-).
%% Create Admin user
% Creating and admin user will finish the "admin party" and will create the
% _users database. Note the output argument is not c, i.e. no
% authentication information is included in c yet.
c=couch; % start from scratch
a=couch(c,'insert admin','{username:lala,password:lele}');
%%
% First add authenticaion information and then check one's own entry in
% _users database.
c.auth.username='lala';
c.auth.password='lele';
c=couch(c,'db','_users');
c.db.info
%% Session
% The session will now contain information about the authenticated user:
s=couch(c,'session')
s.info
%% Admins
% for some reason I don't understand one can't get the admin user
% information back from the _users database. Instead one has to go to the
% _config/admins database
c=couch(c,'db','_config/admins');
c.db.info
%% Delete Admin
% Any admin can delete any admin. Since we have created only one admin, by
% deleting it we are left without admins and the admin party in the
% localhost resumes. Note removing admin is a regular DELETE with no
% worries about versioning.
a=couch(c,'delete admin','lala')
a.curl.call
##### SOURCE END #####
--></body></html>